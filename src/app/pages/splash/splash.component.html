<!-- SPLASH SCREEN -->
<ng-container [ngSwitch]="currentStep">
<div  *ngSwitchCase="'splash'" class="splash-container">
  <div class="content">
    <div class="logo-container">
      <div class="logo-m">
        <img src="assets/icons/metra-logo.svg" alt="Logo">
      </div>
      <h1 class="brand-name">METRA</h1>
    </div>
    <div class="features">
      <p class="feature-text">Генерация образов и фото с помощью персонального аватара.</p>
      <p class="feature-text">Сцены, стили и примерка одежды — в одном пространстве.</p>
      <p class="feature-text-metra">Для доступа ко всем возможностям METRA используется аватар.</p>
    </div>
    <div class="actions">
      <button class="btn-primary" (click)="navigateToCreate()">
        <span>Создать аватар</span>
        <span class="icon">
          <img src="assets/icons/add.svg" alt="Icon">
        </span>
      </button>
      <button class="btn-secondary" (click)="navigateToDemo()">
        Посмотреть, как это работает
      </button>
    </div>
  </div>
</div>

<!-- CREATE AVATAR FORM -->
<div *ngSwitchCase="'form'" class="create-avatar-container" >
  <div class="content">
    <div class="header">
      <h1 class="title">Создать аватар</h1>
    </div>
    <div class="form-content">
      <!-- Имя аватара -->
      <div class="form-group">
        <label class="form-label">Имя аватара</label>
        <input
          type="text"
          name="avatarName"
          class="form-input"
          placeholder="Введите имя своего аватара"
          [(ngModel)]="avatarName">
      </div>
      <!-- Выбор пола -->
      <div class="form-group">
        <label class="form-label">Пол</label>
        <div class="gender-buttons">
          <div class="slider" [ngStyle]="{'transform': gender === 'male' ? 'translateX(0%)' : 'translateX(100%)'}"></div>
          <button
            class="gender-btn"
            [class.active]="gender === 'male'"
            (click)="gender = 'male'">
            Мужской
          </button>
          <button
            class="gender-btn"
            [class.active]="gender === 'female'"
            (click)="gender = 'female'">
            Женский
          </button>
        </div>
      </div>
      <!-- Загрузка фото фронтальной стороны -->
      <div class="photo-load">
        <div class="photo-upload-section">
          <label class="form-label">Загрузите фото с фронтальной стороны</label>
          <div class="upload-row">
            <!-- Кнопка загрузки -->
            <div class="upload-area-small" (click)="triggerFileInput('front',$event)">
              <input
                #frontInput
                type="file"
                accept="image/jpeg,image/jpg,image/png,image/heic,image/webp"
                (change)="onFileSelected($event, 'front')"
                style="display: none;">
              <div class="upload-content">
                <span class="upload-text-small">Загрузить</span>
                <span class="upload-formats">JPEG, JPG, PNG, HEIC, WEBP</span>
              </div>
              <img src="assets/icons/upload.svg" alt="Icon">
            </div>
          </div>
          <p class="upload-hint-small">Хороший свет, без очков и головных уборов</p>
        </div>
        <div class="front-photo">
          <img *ngIf="photos.front" [src]="photos.front" alt="Front Photo" style="width:100%; height:100%;">
          <ng-container *ngIf="!photos.front">
            <img src="assets/icons/vector-front.svg" alt="Front Placeholder" style="padding-top: 8px; padding-left: 6px">
          </ng-container>
          <button *ngIf="photos.front" class="delete-photo"
                  style="position:absolute; top:4px; right:4px;"
                  (click)="removePhoto('front', $event)">
            <img src="assets/icons/delete.svg" alt="">
          </button>
        </div>
      </div>
      <!-- Загрузка фото левого профиля -->
      <div class="photo-load">
        <div class="photo-upload-section">
          <label class="form-label">Загрузите фото с левого профиля</label>
          <div class="upload-row">
            <!-- Кнопка загрузки -->
            <div class="upload-area-small" (click)="triggerFileInput('left', $event)">
              <input
                #leftInput
                type="file"
                accept="image/jpeg,image/jpg,image/png,image/heic,image/webp"
                (change)="onFileSelected($event, 'left')"
                style="display: none;">
              <div class="upload-content">
                <span class="upload-text-small">Загрузить</span>
                <span class="upload-formats">JPEG, JPG, PNG, HEIC, WEBP</span>
              </div>
              <img src="assets/icons/upload.svg" alt="Icon">
            </div>
          </div>
          <p class="upload-hint-small">Хороший свет, без очков и головных уборов</p>
        </div>
        <!-- Блок левого профиля -->
        <div class="front-photo"  >
          <img *ngIf="photos.left" [src]="photos.left" alt="Left Photo" style="width:100%; height:100%;">
          <ng-container *ngIf="!photos.left">
            <img src="assets/icons/vector-left.svg" alt="Left Placeholder" style="padding-top: 10px; padding-left: 6px">
          </ng-container>
          <button *ngIf="photos.left" class="delete-photo"
                  style="position:absolute; top:4px; right:4px;"
                  (click)="removePhoto('left', $event)">
            <img src="assets/icons/delete.svg">
          </button>
        </div>
      </div>

      <div class="photo-load">
        <div class="photo-upload-section">
          <label class="form-label">Загрузите фото с правого профиля</label>
          <div class="upload-row">
            <!-- Кнопка загрузки -->
            <div class="upload-area-small" (click)="triggerFileInput('right', $event)">
              <input
                #rightInput
                type="file"
                accept="image/jpeg,image/jpg,image/png,image/heic,image/webp"
                (change)="onFileSelected($event, 'right')"
                style="display: none;">
              <div class="upload-content">
                <span class="upload-text-small">Загрузить</span>
                <span class="upload-formats">JPEG, JPG, PNG, HEIC, WEBP</span>
              </div>
              <img src="assets/icons/upload.svg" alt="Icon">
            </div>
          </div>
          <p class="upload-hint-small">Хороший свет, без очков и головных уборов</p>
        </div>

        <div class="front-photo"  >
          <img *ngIf="photos.right" [src]="photos.right" alt="Right Photo" style="width:100%; height:100%;">
          <ng-container *ngIf="!photos.right">
            <img src="assets/icons/vector-right.svg" alt="Right Placeholder" style="padding-top: 10px; padding-left: 6px">
          </ng-container>
          <button *ngIf="photos.right" class="delete-photo"
                  style="position:absolute; top:4px; right:4px;"
                  (click)="removePhoto('right', $event)">
            <img src="assets/icons/delete.svg">
          </button>
        </div>
      </div>
      <button
        class="btn-primary"
        [disabled]="!canCreate()"
        (click)="createAvatar()">
        <span>Создать аватар</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>
  <!-- Экран загрузки -->
  <div *ngSwitchCase="'loading'" class="loading-screen">
    <div class="spinner"></div>
    <p>Создаём аватар…</p>
  </div>

  <div *ngSwitchCase="'select'" class="select-screen">
    <div class="success-badge">
          <span class="check-icon">
            <img src="assets/icons/check-circle.svg" alt="">
             <span class="success-text">Ваш аватар создан</span>

          </span>
      <p class="subtitle">Выберите до 3х изображений</p>
    </div>

    <div class="avatar-grid" *ngIf="generatedAvatars.length; else emptyState">
      <div
        class="avatar-card"
        *ngFor="let avatar of generatedAvatars"
        [class.selected]="isSelected(avatar)"
      >
        <div class="avatar-image-wrapper">
          <img *ngIf="photos.front" [src]="photos.front" alt="Front Photo" class="avatar-image" />
          <ng-container *ngIf="!photos.front">
            <img src="assets/icons/vector-front.svg" alt="Front Placeholder" class="avatar-image" />
          </ng-container>
        </div>

        <button
          class="btn-select"
          [class.selected]="isSelected(avatar)"
          (click)="toggleAvatar(avatar)"
        >
          {{ isSelected(avatar) ? 'Выбран' : 'Выбрать' }}
        </button>
      </div>
    </div>

    <ng-template #emptyState>
      <p class="empty-message">Аватары генерируются…</p>
    </ng-template>

    <button class="btn-primary" [disabled]="selectedAvatars.length === 0" (click)="confirmAvatars()">
      Продолжить →
    </button>
  </div>


  <div *ngSwitchCase="'success'" class="success-screen">
    <div class="success-icon">
     <img src="assets/icons/check-circle.svg" alt="">
    </div>
    <h2 class="success-title">Ваши аватары сохранены</h2>
    <div class="gift-card">
      <h3 class="gift-title">Вы получили подарок</h3>
      <h4 class="gift-name">METRA Basic на 7 дней</h4>
      <div class="checked-icon-list">
        <span>
          <img src="assets/icons/check-confirm.svg" alt="">
          <span>120 токенов в месяц</span>
        </span>
        <span>
           <img src="assets/icons/check-confirm.svg" alt="">
          <span>Доступ к сценам METRA</span>
        </span>
        <span>
          <img src="assets/icons/check-confirm.svg" alt="">
          <span>Доступ к Nano Banana</span>
        </span>
      </div>
      <button class="gift-button" (click)="goToHome()">
        <span>Начать использовать METRA</span>
        <img src="assets/icons/arrow-forward.svg" alt="">
      </button>
    </div>
  </div>
</ng-container>
